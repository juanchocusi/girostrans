<?phpdate_default_timezone_set("America/Lima");require_once("controles/classRecibeEntrega.php");/*$datRE = new RecibeEntrega();*/$boton='nuevo';$Fechahora = date("Y-m-d H:i:s");$FechaHoy = date("Y-m-d");$tipousuario= $_SESSION['tipousuario'];?><!DOCTYPE html><html lang="es"><head>  <meta charset="utf-8">  <title>Cierre Diario</title>  <meta name="viewport" content="width=device-width, initial-scale=1.0">  <meta name="description" content="">  <meta name="author" content=""><link rel="stylesheet" href="css/bootstrap.min.css" /><link rel="stylesheet" href="css/style_menu_derecha.css"/> <link rel="stylesheet" href="css/style_menu_izquierda.css"/> <link rel="stylesheet" type="text/css" href="css/jquery-ui.css"/><link rel='stylesheet' type='text/css' href='css/jquery.alerts.css'><!--<script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>--><script type="text/javascript" src="js/jquery.1.7.1.min.js"></script><script type="text/javascript" src="js/jquery.alerts.js"></script><script type="text/javascript" src="js/jquery-ui-1.10.min.js"></script><script type="text/javascript" src="js/bootstrap.min.js"></script><script type="text/javascript" src="js/FuncionesCierreDiario.js"></script><script type="text/javascript" src="js/FnNumeroALetras.js"></script><style>    /*//body {background-color: LightSalmon }*/    #transferencias { font-size: 11px; }    #IngresosDet { font-size: 11px; }               #EgresosDet { font-size: 11px; }    .lbl{        color: Silver;    }    .fila-base{ display: none; } /* fila base oculta */    #concepto_ing { font-size: 10pt; width: 120px; }    #responsable_ing { font-size: 10pt; width: 120px; }    #ingreso {text-align: right; color:purple; font-size: 11pt; width: 60px; background-color:#FFFFF0;}    #concepto_eg { font-size: 10pt; width: 120px; }    #responsable_eg { font-size: 10pt; width: 120px; }    #egreso {text-align: right; font-size: 11pt; color: indigo; width: 60px; background-color:#FFFFF0;}    #fecha_cierre{text-align:center ; font-size: 11pt; font-weight: bold; width: 90px; float: right; background-color:LightSkyBlue;}    #total_egresos {text-align: right; font-size: 10pt; font-weight: bold;  width: 80px; background-color:lavender; color:DarkBlue}    #total_ingresos {text-align: right; font-size: 10pt; font-weight: bold; width: 80px; background-color:lavender; color:DarkBlue}    #total_saldo {text-align: right; font-size: 10pt; font-weight: bold; width: 80px; background-color:lavender; color:ForestGreen }    #codcierrediario {text-align: center; font-size: 10pt; font-weight: bold; width: 80px; color:purple }    #fechacierrediario {text-align: center; font-size: 10pt; font-weight: bold; width: 80px; color: purple }    #lbluscar {float: right}    #lista_diario {font-family:arial;font-size:10px}    /* EDITA */#contiene_tabla{font-family:sans-serif;font-size:12px}table {width:100%;box-shadow:0 0 10px #ddd;text-align:left}th {padding:5px;background:#555;color:#fff}td {padding:5px;border:solid #ddd;border-width:0 0 1px;}.editable span{display:block;}.editable span:hover {background:url(img/edit.png) 90% 50% no-repeat;cursor:pointer}td input{height:24px;width:200px;border:1px solid #ddd;padding:0 5px;margin:0;border-radius:6px;vertical-align:middle}a.enlace{display:inline-block;width:24px;height:24px;margin:0 0 0 5px;overflow:hidden;text-indent:-999em;vertical-align:middle}.guardar{background:url(img/save.png) 0 0 no-repeat}.cancelar{background:url(img/cancel.png) 0 0 no-repeat}.anular{background:url(img/eliminar2.png) 0 0 no-repeat}	    mensaje{display:block;text-align:center;margin:0 0 20px 0}    .ok{display:block;padding:10px;text-align:center;background:green;color:#fff}    .ko{display:block;padding:10px;text-align:center;background:red;color:#fff}#btn_calcula {color: white; background-color: SlateBlue;} </style><script type="text/javascript">$(function($){$('#span_abierto').css('display','none');$('#span_cerrado').css('display','none');$('#total_ingresos').attr('value','0');$('#total_egresos').attr('value','0');$('#total_saldo').attr('value','0');ControlesGuardaI();ControlesGuardaE();    $.datepicker.regional['es'] = {        closeText: 'Cerrar',        prevText: '<Ant',        nextText: 'Sig>',        currentText: 'Hoy',        monthNames: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],        monthNamesShort: ['Ene','Feb','Mar','Abr', 'May','Jun','Jul','Ago','Sep', 'Oct','Nov','Dic'],        dayNames: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],        dayNamesShort: ['Dom','Lun','Mar','Mié','Juv','Vie','Sáb'],        dayNamesMin: ['Do','Lu','Ma','Mi','Ju','Vi','Sá'],        weekHeader: 'Sm',        dateFormat: 'dd/mm/yy',        firstDay: 1,        isRTL: false,        showMonthAfterYear: false,        yearSuffix: ''    };    $.datepicker.setDefaults($.datepicker.regional['es']);});              $(document).ready(function(){      $("#menu-close").click(function(e) {    e.preventDefault();    $("#sidebar-wrapper").toggleClass("active");  });  $("#menu-toggle").click(function(e) {    e.preventDefault();    $("#sidebar-wrapper").toggleClass("active");     });    $("#menu-toggle").focusout(function(e){    e.preventDefault();    $("#sidebar-wrapper").toggleClass("active");    });    $("#fecha_cierre").datepicker({                dateFormat: 'yy/mm/dd',        showOn: 'both',        buttonImage: 'img/calendar.ico',        buttonImageOnly: true,        changeYear: true,        beforeShow: function(){$(".ui-datepicker").css('font-size', 12);},        numberOfMonths: 1,        onSelect: function (dateText){FnMuestraCierre( $('#fecha_cierre').val(),'T'); FnCargaListaDiarios();}        /*onClose: function (selectedDate){CalculaTotalesR();} */   });});</script> </head>        <body><a id="menu-toggle" href="#" class="btn btn-primary btn-sm toggle"><i class="glyphicon glyphicon-th-list"></i></a><div id="sidebar-wrapper"> <!--style="filter:alpha(opacity=65); opacity:0.65;">--><ul class="sidebar-nav nav-list">    <a id="menu-close" href="#" class="btn btn-default btn-sm pull-right toggle"> <i class="glyphicon glyphicon-share-alt"></i></a>                  <div class="form-group">            <label for="css">Lista Diarios</label>                    </div>            <div class="col-xs-12 col-md-8">        <table id="lista_diario" class="editinplace table table-condensed table-hover">            <thead>            <tr>              <td><strong>Fecha</strong></td>              <td><strong>SaldoI</strong></td>              <td><strong>T.Ing</strong></td>              <td><strong>T.Sal</strong></td>              <td><strong>SaldoF</strong></td>            </tr>            </thead>                <tbody id="body_listadiario" >                </tbody>        </table>        </div>   </ul></div> <input type="hidden" name="codsucursal" id="codsucursal" value="<?php echo $_SESSION['codsucursal']?>"><input type="hidden" name="nusuario" id="nusuario" value="<?php echo $_SESSION['nick']?>"><input type="hidden" name="tusuario" id="tusuario" value="<?php echo $_SESSION['tipousuario']?>"><input type="hidden" name="item" id="item"><input type="hidden" name="opt_insert" id="opt_insert"><input type="hidden" name="tingresos" id="tingresos"><input type="hidden" name="trecepcion" id="trecepcion"><input type="hidden" name="tegresos" id="tegresos"><input type="hidden" name="tentrega" id="tentrega"><input type="hidden" name="tpendiente" id="tpendiente"><input type="hidden" name="fechadehoy" id="fechadehoy" value="<?php echo $FechaHoy ?>" ><input type="hidden" name="fechahoradehoy" id="fechahoradehoy" value="<?php echo $Fechahora ?>" ><input type="hidden" name="estado" id="estado"><input type="hidden" name="numletras" id="numletras"><input type="hidden" name="sele" id="sele" value="I[0]" ><input type="text" readonly="readonly" name="codcierrediario" id="codcierrediario"><input type="text" readonly="readonly" name="fechacierrediario" id="fechacierrediario"><?php echo $_SESSION['sucursal']?> (<?php echo $_SESSION['usuario']?>/<?php echo $_SESSION['tipousuario']?>) Hoy=<?php echo $FechaHoy ?><div class="container">    <div id="carga" style="display:none"> <img src="img/cargando.gif" /> </div>                   <div class="mensaje"></div>     <div id="detalle"  class="row ">     <div id="carga1" style="display:none"> <img src="img/cargando.gif" /> </div><div class="col-xs-6 col-sm-6 col-lg-4 form-group has-success input-group-sm"><div class="btn-toolbar" role="toolbar">        <button type="button" onclick="FnCargaDetalle();" class="btn btn-default btn-sm">        <span class="glyphicon glyphicon-refresh"></span>    </button>               <button type="button" id="nuevo_ing" onclick="ActivaControles('I');" class="btn btn-default btn-xs">        <span class="glyphicon glyphicon-plus"></span>     </button>       <input type="text" onkeyup='javascript:this.value=this.value.toUpperCase();' id="concepto_ing"  placeholder="Concepto" >    <input type="text" onkeyup='javascript:this.value=this.value.toUpperCase();' id="responsable_ing"  placeholder="Responsable" >     <input type="text" id="ingreso"  placeholder="Ingreso" value="0" onfocus="if (this.value >= '0') {this.value = '';}" onblur="ADecimal();" >        <button type="button" id="inserta_ing"  onclick="FnInsertaIngresos();" class="btn btn-default btn-xs">        <span class="glyphicon glyphicon-save"></span>    </button>    <button type="button" id="imprime_ing" class="btn btn-default btn-xs">        <span class="glyphicon glyphicon-print"></span>    </button>    </div>        <table id="IngresosDet" class="editinplace table table-condensed table-hover">        <thead>        <tr>            <th>Nro</th>            <th>Concepto</th>            <th>Responsable</th>            <th>Ingreso</th>        </tr>        </thead>        <tbody id="body_ingresos" >                                </tbody>    </table></div>    <div class="col-xs-6 col-sm-6 col-lg-4 form-group has-success input-group-sm">    <div class="btn-toolbar" role="toolbar">        <button id="btn_calcula" type="button" onclick="FnCalculaTotales();" class="btn btn-default btn-sm">            <span class="glyphicon glyphicon-usd"></span>        </button>           <button type="button" id="nuevo_eg" onclick="ActivaControles('E');" class="btn btn-default btn-xs">            <span class="glyphicon glyphicon-plus"></span>         </button>        <input type="text" onkeyup='javascript:this.value=this.value.toUpperCase();' id="concepto_eg"  placeholder="Concepto" >        <input type="text" onkeyup='javascript:this.value=this.value.toUpperCase();' id="responsable_eg"  placeholder="Responsable" >         <input type="text" id="egreso"  placeholder="Egreso" value="0" onfocus="if (this.value >= '0') {this.value = '';}" >        <button type="button" id="inserta_eg"  onclick="FnInsertaEgresos();" class="btn btn-default btn-xs">        <span class="glyphicon glyphicon-save"></span>        </button>        <button type="button" id="imprime_sal" class="btn btn-default btn-xs">        <span class="glyphicon glyphicon-print"></span>        </button>    </div>    <table id="EgresosDet" class="table table-condensed table-hover">        <thead>        <tr>            <th>Nro</th>            <th>Concepto</th>            <th>Responsable</th>            <th>Salida</th>        </tr>        </thead>        <tbody id="body_egresos" >                    </tbody>    </table></div></div><div>    <button type="button" class="btn btn-default btn-xs"> <span id="span_abierto" class="glyphicon glyphicon-thumbs-up"></span> <span id="span_cerrado" class="glyphicon glyphicon-lock"></span> </button>        <label for="text">Total Ingresos :</label> <input type="text" id="total_ingresos" readonly="readonly"/>    <label for="text">Total Egresos :</label> <input type="text" id="total_egresos" readonly="readonly"/>         <label for="text">Saldo Final :</label> <input type="text" id="total_saldo" readonly="readonly"/>         <input type="text" id="fecha_cierre" name="fecha_cierre" readonly="readonly" placeholder="Buscar Cierre">      </div>     <!-- Transferencias -->            <div class="row clearfix"> <div class="col-md-12 column">    <table id="transferencias" class="table table-condensed table-hover ">    <thead>	<tr>            <th>Nro</th>            <th>Codigo	</th>            <th>Destino	</th>            <th>Fecha Registro </th>            <th>Fecha Entrega  </th>            <th>Beneficiario  </th>            <th>Remitente  </th>            <th>Entrega     </th>            <th>Recepcion  </th>            <th>Pendiente  </th>	</tr>	</thead>        <tbody id="body_transferencias" >                    </tbody>    </table></div></div></div> <!-- CONTAINER --><script type="text/javascript" language="javascript" src="js/validacampos.js"></script><script type="text/javascript">$(document).ready(function(){var fecha_hoy="<?php echo $FechaHoy?>";var fecha_diario = $('#fechacierrediario').val();var usuario_sistema = "<?php echo $tipousuario?>";var codigosucursal=$('#codsucursal').val();/*alert(codigosucursal,fecha_hoy);*/$('#fecha_cierre').attr('value',fecha_hoy);FnUbicaDiario(codigosucursal,fecha_hoy);var td,campo,valor,id;$(document).on("dblclick","td.editable span",function(e){if (fecha_hoy === fecha_diario){    e.preventDefault();    $("td:not(.id)").removeClass("editable");    td=$(this).closest("td");    campo=$(this).closest("td").data("campo");    valor=$(this).text();    id=$(this).closest("tr").find(".id").text();    td.text("").html("<input type='text' style='text-transform:uppercase;' onkeyup='javascript:this.value=this.value.toUpperCase();' name='"+campo+"' value='"+valor+"'><a class='enlace guardar' href='#'>Guardar</a> <a class='enlace cancelar' href='#'>Cancelar</a>  <a class='enlace anular' href='#'>Cancelar</a>");     } else {     if (usuario_sistema === 'ADMIN'){       e.preventDefault();       $("td:not(.id)").removeClass("editable");       td=$(this).closest("td");       campo=$(this).closest("td").data("campo");       valor=$(this).text();       id=$(this).closest("tr").find(".id").text();       td.text("").html("<input type='text' style='text-transform:uppercase;' onkeyup='javascript:this.value=this.value.toUpperCase();' name='"+campo+"' value='"+valor+"'><a class='enlace guardar' href='#'>Guardar</a> <a class='enlace cancelar' href='#'>Cancelar</a>  <a class='enlace anular' href='#'>Cancelar</a>");    } else { jAlert('No puede modificar...:'+ fecha_hoy , 'Transferencias'); }    }});		$(document).on("click",".guardar",function(e){    $(".mensaje").html("<img src='img/loader32.gif'>");    e.preventDefault();    nuevovalor=$(this).closest("td").find("input").val();    if(nuevovalor.trim()!=="")    {        $.ajax({        type: "POST",        url: "controles/ManteCierreDiario.php",        data: { campo: campo, valor: nuevovalor, item:$("#item").val(), coddiario: $("#codcierrediario").val(), opt:'update'}        }).done(function( msg ) {            $('.mensaje').css('display','block');            $(".mensaje").html(msg);            td.html("<span>"+nuevovalor+"</span>");            $("td:not(.id)").addClass("editable");            setTimeout(function() {$('.ok,.ko').fadeOut('fast');}, 3000);            FnCargaDetalle();        });    }    else $(".mensaje").html("<p class='ko'>Debes ingresar un valor</p>");});$(document).on("click",".cancelar",function(e){    e.preventDefault();    td.html("<span>"+valor+"</span>");    $("td:not(.id)").addClass("editable");});$(document).on("click",".anular",function(e){        jConfirm("¿Esta seguro de Eliminar?", "Transferencias", function(r) {    $(".mensaje").html("<img src='img/loader32.gif'>");    e.preventDefault();    if(r) {        $.ajax({        type: "POST",        url: "controles/ManteCierreDiario.php",        data: { coddiario: $("#codcierrediario").val(), item:$("#item").val(), opt:'EI' }                }).done(function( msg ) {            $('.mensaje').css('display','block');            $(".mensaje").html(msg);            /*td.html("<span>"+nuevovalor+"</span>");*/            $("td:not(.id)").addClass("editable");            /*setTimeout(function() {$('.ok,.ko').fadeOut('fast');}, 2000);*/                        FnCargaDetalle();        }); /* end done ajax*/    }    else $(".mensaje").html("<p class='ko'>Debes ingresar un valor</p>");    }); /* end jconfirm*/}); /* onclick*///end if});  //end DocumentReady            $(function(){                              //Para escribir solo numeros                   $('#ingreso').validacampos('.0123456789');                $('#egreso').validacampos('.0123456789');                                                });             ActivaControles('G');</script>      <div class="header"></div>        <div class="scroll"></div>        <ul id="navigation">             <li class="nuevo"  ><a onclick="FnCreaNuevoCierre();" title="nuevo"> Nuevo </a></li>            <li class="cerrar"><a onclick="FnCierreDiario();" title="cerrar">Cerrar</a></li>            <li class="actualiza"><a onclick="FnActualizaDiario();" title="actualiza">Actualiza</a></li>            <li class="imprimir"><a id="imprimediario" title="imprimir">Imprimir</a></li>                        <li class="podcasts"><a href="" title="Podcasts"></a></li>            <li class="contact"><a href="" title="Contact"></a></li>        </ul><script type="text/javascript"> $(function() { $('#navigation a').stop().animate({'marginLeft':'-85px'},1000); $('#navigation > li').hover( function () {              $('a',$(this)).stop().animate({'marginLeft':'-2px'},200);              },function () {              $('a',$(this)).stop().animate({'marginLeft':'-85px'},200);            }            );            });</script><script language="JavaScript" type="text/JavaScript">$(document).ready(function() {    $("#imprimediario").click(function(){    if($("#codcierrediario").val() !== ''){        jConfirm("¿Se imprimira DIARIO con fecha:\n"+ $("#fechacierrediario").val(), "Transferencias", function(r) {            if(r) {             var codsucu = $("#codsucursal").val();            var fecha =$("#fecha_cierre").val();            var coddiario=$("#codcierrediario").val();            var nombresucu="<?php echo $_SESSION['sucursal'];?>";            var totaling = $("#total_ingresos").val();            var totalsal = $("#total_egresos").val();            var saldof = $("#total_saldo").val();            var nusuario=$("#nusuario").val();            //window.open('imprimediario.php?codsucu='+codsucu+'&fecha='+fecha,'_blank');  // changed here (cambiado aquí)            window.open('imprimediario.php?codsucu='+codsucu+'&fecha='+fecha+'&coddiario='+coddiario+'&nombresucu='+nombresucu                          +'&totaling='+totaling+'&totalsal='+totalsal+'&saldof='+saldof+'&nusuario='+nusuario,'_blank');  // changed here (cambiado aquí)            }          });          } else { jAlert ('Seleccione Diario a imprimir, verifique...','Transferencias'); }      }); //click  $("#imprime_ing").click(function(){ var ingreso =$("#ingreso").val();    if($("#codcierrediario").val() !== '' && ingreso>0){        jConfirm("¿Se imprimira Recibo de Ingresos :\n"+ $("#concepto_ing").val()+'-->'+$("#ingreso").val() , "Transferencias", function(r) {            if(r) {             var responsable = $("#responsable_ing").val();                        var num_letras = covertirNumLetras(ingreso);            var concepto = $("#concepto_ing").val();                        var nombreusuario = "<?php echo $_SESSION['usuario'];?>";                        var opt = 'IN';            //window.open('imprimediario.php?codsucu='+codsucu+'&fecha='+fecha,'_blank');  // changed here (cambiado aquí)            window.open('ImprimeRecibos.php?responsable='+responsable+'&ingreso='+ingreso+'&num_letras='+num_letras+'&concepto='+concepto                          +'&nombreusuario='+nombreusuario+'&opt='+opt,'_blank');  // changed here (cambiado aquí)            }          });          } else { jAlert ('Seleccione item a imprimir, verifique...','Transferencias'); }      }); //click $("#imprime_sal").click(function(){ var egreso =$("#egreso").val();    if($("#codcierrediario").val() !== '' && egreso>0){        jConfirm("¿Se imprimira Recibo de Egresos :\n"+ $("#concepto_eg").val()+'-->'+$("#egreso").val() , "Transferencias", function(r) {            if(r) {             var responsable = $("#responsable_eg").val();                        var num_letras = covertirNumLetras(egreso);            var concepto = $("#concepto_eg").val();                        var nombreusuario = "<?php echo $_SESSION['usuario'];?>";                        var opt = 'SA';            //window.open('imprimediario.php?codsucu='+codsucu+'&fecha='+fecha,'_blank');  // changed here (cambiado aquí)            window.open('ImprimeRecibos.php?responsable='+responsable+'&egreso='+egreso+'&num_letras='+num_letras+'&concepto='+concepto                          +'&nombreusuario='+nombreusuario+'&opt='+opt,'_blank');  // changed here (cambiado aquí)            }          });    } else { jAlert ('Seleccione item a imprimir, verifique...','Transferencias'); }      }); //click  }); //Documen</script></body></html>